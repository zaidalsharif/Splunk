<dashboard version="1.1" theme="dark">
  <label>Audit &amp; Compliance</label>
  <description>Command Execution, File Changes, User Activity Tracking</description>
  
  <row>
    <panel>
      <title>üìù Audit Events (Last Hour)</title>
      <single>
        <search>
          <query>index=security sourcetype=linux_audit earliest=-1h | stats count</query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x53a051","0x53a051","0x53a051"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>‚ö° Command Executions</title>
      <single>
        <search>
          <query>index=security sourcetype=linux_audit type=EXECVE earliest=-1h | stats count</query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
    <panel>
      <title>üìÅ File Access Events</title>
      <single>
        <search>
          <query>index=security sourcetype=linux_audit (type=PATH OR type=SYSCALL) earliest=-1h | stats count</query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
    <panel>
      <title>üîê Auth Events</title>
      <single>
        <search>
          <query>index=security sourcetype=linux_audit type=USER_AUTH earliest=-1h | stats count</query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Audit Events Over Time</title>
      <chart>
        <search>
          <query>
index=security sourcetype=linux_audit earliest=-24h
| rex "type=(?&lt;audit_type&gt;\w+)"
| timechart span=1h count by audit_type limit=10
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Command Executions (EXECVE)</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit type=EXECVE earliest=-4h
| rex "a0=\"(?&lt;command&gt;[^\"]+)\""
| rex "a1=\"(?&lt;arg1&gt;[^\"]+)\""
| rex "a2=\"(?&lt;arg2&gt;[^\"]+)\""
| eval full_command = command." ".if(isnotnull(arg1),arg1,"")." ".if(isnotnull(arg2),arg2,"")
| table _time host full_command
| sort -_time
| head 30
          </query>
          <earliest>-4h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Sudo Activity</title>
      <table>
        <search>
          <query>
index=security sudo earliest=-24h
| rex "sudo:\s+(?&lt;user&gt;\S+)\s+:\s+(?&lt;result&gt;[^;]+);\s+TTY=(?&lt;tty&gt;\S+)\s+;\s+PWD=(?&lt;pwd&gt;\S+)\s+;\s+USER=(?&lt;target_user&gt;\S+)\s+;\s+COMMAND=(?&lt;command&gt;.+)"
| table _time host user target_user command result
| sort -_time
| head 25
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>File/Config Changes</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit (key=identity OR key=sudoers_changes OR key=ssh_keys OR key=network_config) earliest=-24h
| rex "name=\"(?&lt;filename&gt;[^\"]+)\""
| rex "key=\"(?&lt;key&gt;[^\"]+)\""
| table _time host key filename
| sort -_time
| head 20
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>User/Group Changes</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit (type=ADD_USER OR type=DEL_USER OR type=ADD_GROUP OR type=USER_MGMT) earliest=-7d
| rex "type=(?&lt;event_type&gt;\w+)"
| table _time host event_type _raw
| sort -_time
| head 15
          </query>
          <earliest>-7d</earliest>
          <latest>now</latest>
          <refresh>300s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Network Connections (Socket Activity)</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit key=network_connections earliest=-4h
| rex "saddr=(?&lt;dest_addr&gt;\S+)"
| table _time host dest_addr
| sort -_time
| head 20
          </query>
          <earliest>-4h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Bash History Commands</title>
      <table>
        <search>
          <query>
index=security sourcetype=bash_history earliest=-24h
| table _time host _raw
| sort -_time
| head 30
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Audit Event Types Distribution</title>
      <chart>
        <search>
          <query>
index=security sourcetype=linux_audit earliest=-24h
| rex "type=(?&lt;audit_type&gt;\w+)"
| stats count by audit_type
| sort -count
| head 15
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
    <panel>
      <title>Activity by Host</title>
      <chart>
        <search>
          <query>
index=security sourcetype=linux_audit earliest=-24h
| stats count by host
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>
</dashboard>

