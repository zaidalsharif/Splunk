<dashboard version="1.1" theme="dark">
  <label>ğŸ  Home Lab Overview</label>
  <description>Executive Summary - All Systems at a Glance</description>
  
  <row>
    <panel>
      <title>ğŸŸ¢ System Health</title>
      <single>
        <search>
          <query>
| tstats dc(host) as hosts WHERE index=* earliest=-5m
| eval status = if(hosts >= 5, "HEALTHY", if(hosts >= 3, "DEGRADED", "CRITICAL"))
| table status
          </query>
          <earliest>-5m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ–¥ï¸ Active Hosts</title>
      <single>
        <search>
          <query>| tstats dc(host) WHERE index=* earliest=-5m</query>
          <earliest>-5m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xf8be34","0x53a051"]</option>
        <option name="rangeValues">[3,5]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ³ Running Containers</title>
      <single>
        <search>
          <query>
index=docker sourcetype="docker:container:status" earliest=-5m
| dedup names
| stats count
          </query>
          <earliest>-5m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0x53a051","0x53a051"]</option>
        <option name="rangeValues">[10,100]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ“Š Events/sec</title>
      <single>
        <search>
          <query>
| tstats count WHERE index=* earliest=-5m
| eval eps = round(count / 300, 2)
| table eps
          </query>
          <earliest>-5m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="unit">eps</option>
      </single>
    </panel>
    <panel>
      <title>ğŸ’¾ Events Today</title>
      <single>
        <search>
          <query>| tstats count WHERE index=* earliest=@d</query>
          <earliest>@d</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>ğŸ” Security Summary</title>
      <html>
        <style>
          .security-stats { display: flex; justify-content: space-around; text-align: center; padding: 10px; }
          .stat-box { padding: 15px; }
          .stat-value { font-size: 28px; font-weight: bold; }
          .stat-label { color: #888; font-size: 12px; }
        </style>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>ğŸ” Failed Logins (24h)</title>
      <single>
        <search>
          <query>index=security "Failed password" OR "authentication failure" earliest=-24h | stats count</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[10,50]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>âœ… Successful Logins (24h)</title>
      <single>
        <search>
          <query>index=security "Accepted" earliest=-24h | stats count</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x53a051","0x53a051","0x53a051"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>âš ï¸ Security Events (24h)</title>
      <single>
        <search>
          <query>index=security earliest=-24h | stats count</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
    <panel>
      <title>ğŸ›¡ï¸ Sudo Commands (24h)</title>
      <single>
        <search>
          <query>index=security sudo earliest=-24h | stats count</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Event Volume by Index (Last 24h)</title>
      <chart>
        <search>
          <query>
| tstats count WHERE index=* earliest=-24h by index
| sort -count
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
    <panel>
      <title>Events Over Time (All Indexes)</title>
      <chart>
        <search>
          <query>
| tstats count WHERE index=* earliest=-24h by _time index span=1h
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Docker Swarm Node Status</title>
      <table>
        <search>
          <query>
index=docker sourcetype="docker:swarm:node" earliest=-5m
| dedup hostname
| table hostname status availability manager_status
| rename hostname as "Node" status as "Status" availability as "Availability" manager_status as "Role"
          </query>
          <earliest>-5m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Top 10 Active Containers by Logs</title>
      <table>
        <search>
          <query>
index=docker sourcetype="docker:container:json" earliest=-1h
| rex field=source "/var/lib/docker/containers/(?&lt;container_id&gt;[^/]+)/"
| eval short_id = substr(container_id, 1, 12)
| stats count by short_id
| sort -count
| head 10
| rename short_id as "Container ID" count as "Events"
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>ğŸŒ Traefik - Request Rate (Last Hour)</title>
      <chart>
        <search>
          <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-1h
| timechart span=5m count as "Requests"
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
      </chart>
    </panel>
    <panel>
      <title>âš ï¸ Recent Errors (All Sources)</title>
      <table>
        <search>
          <query>
index=* (error OR Error OR ERROR OR fail OR FAIL OR critical OR CRITICAL) earliest=-1h
| table _time index host _raw
| sort -_time
| head 10
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Data Sources Health Check</title>
      <table>
        <search>
          <query>
| tstats latest(_time) as last_event count WHERE index=* earliest=-24h by index host
| eval age_minutes = round((now() - last_event) / 60, 1)
| eval status = if(age_minutes &lt; 5, "âœ… Active", if(age_minutes &lt; 30, "âš ï¸ Delayed", "âŒ Stale"))
| convert ctime(last_event)
| table host index status last_event count age_minutes
| sort age_minutes
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
</dashboard>

