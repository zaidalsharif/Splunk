<dashboard version="1.1" theme="dark">
    <label>Traefik Proxy</label>
    <description>API Gateway, Request Routing, HTTP Traffic Analysis</description>

    <row>
        <panel>
            <title>üåê Total Requests (Last Hour)</title>
            <single>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-1h
| stats count
                    </query>
                    <earliest>-1h</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["0x53a051","0x53a051","0x53a051"]</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>‚ùå Error Responses (4xx/5xx)</title>
            <single>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-1h
| rex "\"(?&lt;status_code&gt;[45]\d{2})\""
| stats count
                    </query>
                    <earliest>-1h</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
                <option name="rangeValues">[10,50]</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>üìä Avg Response Time</title>
            <single>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-1h
| rex "\"Duration\":(?&lt;duration&gt;\d+)"
| eval duration_ms = duration/1000000
| stats avg(duration_ms) as avg_ms
| eval avg_ms = round(avg_ms,2)
                    </query>
                    <earliest>-1h</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                </search>
                <option name="unit">ms</option>
                <option name="colorMode">block</option>
                <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
                <option name="rangeValues">[100,500]</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>üñ•Ô∏è Unique Clients</title>
            <single>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-1h
| rex "\"ClientAddr\":\"(?&lt;client_ip&gt;[^:\"]+)"
| stats dc(client_ip)
                    </query>
                    <earliest>-1h</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                </search>
            </single>
        </panel>
    </row>

    <row>
        <panel>
            <title>Request Rate Over Time</title>
            <chart>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| timechart span=5m count as Requests
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                </search>
                <option name="charting.chart">area</option>
                <option name="charting.chart.nullValueMode">zero</option>
                <option name="charting.axisTitleY.text">Requests</option>
            </chart>
        </panel>
    </row>

    <row>
        <panel>
            <title>HTTP Status Codes Distribution</title>
            <chart>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| rex "\"OriginStatus\":(?&lt;status&gt;\d+)"
| eval status_group = case(
    status &gt;= 200 AND status &lt; 300, "2xx Success",
    status &gt;= 300 AND status &lt; 400, "3xx Redirect",
    status &gt;= 400 AND status &lt; 500, "4xx Client Error",
    status &gt;= 500, "5xx Server Error",
    true(), "Other"
)
| stats count by status_group
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="charting.chart">pie</option>
                <option name="charting.fieldColors">{"2xx Success": 0x53a051, "3xx Redirect": 0x006d9c, "4xx Client Error": 0xf8be34, "5xx Server Error": 0xdc4e41}</option>
            </chart>
        </panel>
        <panel>
            <title>Top Services/Backends</title>
            <chart>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| rex "\"ServiceName\":\"(?&lt;service&gt;[^\"]+)\""
| stats count by service
| sort -count
| head 10
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="charting.chart">bar</option>
            </chart>
        </panel>
    </row>

    <row>
        <panel>
            <title>Top Requested Paths</title>
            <table>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| rex "\"RequestPath\":\"(?&lt;path&gt;[^\"]+)\""
| stats count by path
| sort -count
| head 20
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
        <panel>
            <title>Top Client IPs</title>
            <table>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| rex "\"ClientAddr\":\"(?&lt;client_ip&gt;[^:\"]+)"
| stats count as requests by client_ip
| sort -requests
| head 15
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
    </row>

    <row>
        <panel>
            <title>Response Time Distribution</title>
            <chart>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| rex "\"Duration\":(?&lt;duration&gt;\d+)"
| eval duration_ms = duration/1000000
| eval latency_bucket = case(
    duration_ms &lt; 50, "&lt;50ms",
    duration_ms &lt; 100, "50-100ms",
    duration_ms &lt; 250, "100-250ms",
    duration_ms &lt; 500, "250-500ms",
    duration_ms &lt; 1000, "500ms-1s",
    true(), "&gt;1s"
)
| stats count by latency_bucket
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="charting.chart">pie</option>
            </chart>
        </panel>
        <panel>
            <title>Slowest Requests</title>
            <table>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-1h
| rex "\"RequestPath\":\"(?&lt;path&gt;[^\"]+)\""
| rex "\"Duration\":(?&lt;duration&gt;\d+)"
| rex "\"ServiceName\":\"(?&lt;service&gt;[^\"]+)\""
| eval duration_ms = round(duration/1000000,2)
| sort -duration_ms
| table _time service path duration_ms
| head 10
| rename duration_ms as "Response Time (ms)"
                    </query>
                    <earliest>-1h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
    </row>

    <row>
        <panel>
            <title>Error Requests (4xx/5xx)</title>
            <table>
                <search>
                    <query>
index=docker (sourcetype="traefik:access" OR sourcetype="docker:container:json") traefik earliest=-4h
| rex "\"OriginStatus\":(?&lt;status&gt;[45]\d{2})"
| rex "\"RequestPath\":\"(?&lt;path&gt;[^\"]+)\""
| rex "\"ServiceName\":\"(?&lt;service&gt;[^\"]+)\""
| rex "\"ClientAddr\":\"(?&lt;client_ip&gt;[^:\"]+)"
| where isnotnull(status)
| table _time status service path client_ip
| sort -_time
| head 20
                    </query>
                    <earliest>-4h</earliest>
                    <latest>now</latest>
                    <refresh>60s</refresh>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
    </row>
</dashboard>

