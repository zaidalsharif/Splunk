<dashboard version="1.1" theme="dark">
  <label>Threat Detection &amp; Alerts</label>
  <description>Security Threats, Anomalies, Attack Detection</description>
  
  <row>
    <panel>
      <title>üö® Active Threats</title>
      <single>
        <search>
          <query>
index=security earliest=-1h
| search "Failed password" OR "Invalid user" OR "BREAK-IN ATTEMPT" OR "attack" OR "malicious"
| stats count
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[5,20]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>üîç Suspicious Activities</title>
      <single>
        <search>
          <query>
index=security earliest=-1h
| search "Connection closed by" OR "Bad protocol" OR "Did not receive" OR "reverse mapping"
| stats count
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[10,50]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>üõ°Ô∏è Blocked Connections</title>
      <single>
        <search>
          <query>
index=linux (DROP OR BLOCK OR DENY) earliest=-1h
| stats count
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
      </single>
    </panel>
    <panel>
      <title>‚ö° Privilege Escalation</title>
      <single>
        <search>
          <query>
index=security (sudo OR su:) earliest=-1h
| stats count
          </query>
          <earliest>-1h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>‚ö†Ô∏è CRITICAL: Brute Force Attacks (5+ failures in 10min)</title>
      <table>
        <search>
          <query>
index=security "Failed password" earliest=-24h
| rex "from\s+(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)"
| bin _time span=10m
| stats count dc(user) as targeted_users values(user) as users by _time src_ip host
| where count >= 5
| sort -_time
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>‚ö†Ô∏è Invalid/Unknown User Attempts</title>
      <table>
        <search>
          <query>
index=security "Invalid user" earliest=-24h
| rex "Invalid user\s+(?&lt;user&gt;\S+)\s+from\s+(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)"
| stats count first(_time) as first_seen last(_time) as last_seen by user src_ip host
| convert ctime(first_seen) ctime(last_seen)
| sort -count
| head 20
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Root Login Attempts</title>
      <table>
        <search>
          <query>
index=security (user=root OR "for root") earliest=-24h
| rex "from\s+(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)"
| rex "(?&lt;result&gt;Accepted|Failed)"
| table _time host result src_ip
| sort -_time
| head 20
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Suspicious Process Execution</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit type=EXECVE earliest=-4h
| rex "a0=\"(?&lt;command&gt;[^\"]+)\""
| search command IN ("nc", "ncat", "netcat", "wget", "curl", "python", "perl", "ruby", "bash", "sh", "chmod", "chown")
| table _time host command
| sort -_time
| head 30
          </query>
          <earliest>-4h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Outbound Network Connections</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit key=network_connections earliest=-4h
| table _time host _raw
| sort -_time
| head 20
          </query>
          <earliest>-4h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Failed Sudo Attempts</title>
      <table>
        <search>
          <query>
index=security sudo "NOT in sudoers" OR "incorrect password" OR "authentication failure" earliest=-24h
| table _time host _raw
| sort -_time
| head 15
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel>
      <title>Configuration File Changes</title>
      <table>
        <search>
          <query>
index=security sourcetype=linux_audit (key=identity OR key=sudoers_changes OR key=ssh_keys OR key=network_config) earliest=-24h
| rex "name=\"(?&lt;file&gt;[^\"]+)\""
| table _time host key file
| sort -_time
| head 15
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Threat Timeline</title>
      <chart>
        <search>
          <query>
index=security earliest=-24h
| eval threat_type = case(
    match(_raw, "Failed password"), "Failed Login",
    match(_raw, "Invalid user"), "Invalid User",
    match(_raw, "sudo"), "Privilege Escalation",
    match(_raw, "DROP|BLOCK|DENY"), "Blocked Connection",
    true(), "Other"
)
| timechart span=1h count by threat_type
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Top Attacking IPs (Failed Attempts)</title>
      <chart>
        <search>
          <query>
index=security ("Failed password" OR "Invalid user") earliest=-24h
| rex "from\s+(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)"
| stats count by src_ip
| sort -count
| head 10
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
    <panel>
      <title>Attack Source Geolocation</title>
      <table>
        <search>
          <query>
index=security ("Failed password" OR "Invalid user") earliest=-24h
| rex "from\s+(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)"
| iplocation src_ip
| stats count by src_ip City Region Country
| sort -count
| head 15
          </query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
</dashboard>

